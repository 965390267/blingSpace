{"version":3,"file":"vue.js","sources":["../../src/observer/array.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["import { observe } from \"./index.js\";\n\n// 拦截用户调用的push shift unshift pop reverse sort splice concat\n\nlet oldArrayProtoMethods = Array.prototype;\n\nexport let arrayMethods = Object.create(oldArrayProtoMethods);\n\nlet methods = ['push','shift','unshift', 'pop', 'reverse', 'sort', 'splice', 'concat'];\n\n\nmethods.forEach(method=>{\n    // console.log(arrayMethods,method);\n\n    arrayMethods[method] = function (...args){\n        let r = oldArrayProtoMethods[method].apply(this,args)\n\n        // todo\n        let inserted;\n        let ob = this.__ob__;\n        switch (method) {\n            case 'push':\n            case 'unshift':\n                inserted = args;break;\n            case \"splice\":\n                inserted = args.slice(2)\n            default:\n                break;\n        }\n        // console.log(inserted);\n\n        if(inserted) ob.observerArray(inserted)\n        console.log('数组更新方法 == 去渲染页面');\n        return r;\n\n    }\n})\n\n","import {arrayMethods} from './array';\nclass Observer {\n    constructor(data){\n\n        if (Array.isArray(data)) {\n            // 新增属性，声明此属性已被观测\n            Object.defineProperty(data,\"__ob__\",{\n                enumerable:false,\n                configurable: false,\n                value:this\n            })\n\n            // 只能拦截数组的方法，但对数组中的每一项 无法监听 需要观测\n            data.__proto__ = arrayMethods;\n            this.observerArray(data)\n            // console.log(data,arrayMethods);\n\n        } else {\n            this.walk(data)\n        }\n    }\n    walk(data){\n        let keys = Object.keys(data);\n        keys.forEach(key=>{\n            defineReactuve(data,key,data[key]);\n        })\n    }\n    observerArray(value) {\n        for (let i  = 0; i < value.length; i++) {\n            observe(value[i])\n        }\n    }\n}\n\nfunction defineReactuve(data,key,value){\n    // 实现递归\n    observe(value)\n    Object.defineProperty(data,key,{\n        get(){\n            console.log('用户取值');\n            return value\n        },\n        set(newValue){\n            console.log('用户赋值');\n            if(value !== newValue){\n                // 对新赋值的对象进行观测\n                observe(newValue);\n                value = newValue\n            }\n        }\n    }\n    )\n\n\n}\n\nexport function observe(data){\n    if(typeof data !== 'object' || data == null){\n        return;\n    }\n    if(data.__ob__) return;\n    return new Observer(data);\n}","import { observe } from \"./observer/index\";\n\nexport function initState(vm){\n    let opts = vm.$options;\n    let {methods,data,props,computed,watch} = opts;\n    if(methods){\n        initMethod(vm)\n    }\n    if(data){\n        initData(vm)\n    }\n    if(props){\n        initProps(vm)\n    }\n    if(computed){\n        initComputed(vm)\n    }\n    if(watch){\n        initWatch(vm)\n    }\n\n}\nfunction initMethod(vm) {\n\n}\nfunction proxy(vm,data,key) {\n    Object.defineProperty(vm,key,{\n        get(){\n            return vm[data][key];\n        },\n        set(newValue){\n            vm[data][key] = newValue;\n        }\n    })\n}\nfunction initData(vm) {\n    let data = vm.$options.data;\n    vm._data = data = typeof data == 'function' ? data.call(vm) : data;\n\n    // 进行代理，实现直接从实例上处理数据\n    for (const key in data) {\n       proxy(vm,'_data',key)\n    }\n\n    observe(data);\n}\nfunction initProps(vm) {\n\n}\nfunction initComputed(vm) {\n\n}\nfunction initWatch(vm) {\n\n}","import { initState } from \"./state\";\n\nexport function initMixin(Vue) {\n    Vue.prototype._init = function (options) {\n        const vm = this;\n        vm.$options = options;\n\n        // 初始化数据\n        initState(vm)\n    }\n}","import {initMixin} from './init';\n\nfunction Vue(options){\n    this._init(options);\n}\ninitMixin(Vue);\n\n\nexport default Vue;"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","r","apply","inserted","ob","__ob__","slice","observerArray","console","log","Observer","data","isArray","defineProperty","enumerable","configurable","value","__proto__","walk","keys","key","defineReactuve","i","length","observe","get","set","newValue","initState","vm","opts","$options","props","computed","watch","initData","proxy","_data","call","initMixin","Vue","_init","options"],"mappings":"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"}